\section{Inferring User State from Location Data}


% Using location data to infer behaviour and mental state
% Litterature review should indicate which features are relevant
% Feature are anything derived from the location data, i.e. clusters, trajectories, number of clusters etc.


% Saeb
%   More related to mental health
%   Can we infer users mental state from location data
%   A list of mobility features provided, which this thesis to large extent is based upon
%   Does not discuss how the Circadian Movement feature is computed exactly
%   It was not defined in a way which allowed it to be directly replicated
%   PHQ9 questionnaire
%   Our study suggests that it is possible to monitor depression passively using phone sensor data, and in particular, GPS. This has significant public health implications. Most people are unwilling to answer questions repeatedly over long periods of time, while passive monitoring could improve the management of depression in populations, allowing at risk patients to be treated more quickly as symptoms emerge, or monitoring patientsâ€™ responses during treatment.

Mobile sensing is the ability to unobtrusively collect sensor data from built-in phone sensors, and within the realm behaviour and mental state inference, location data is commonly used. The work done by Saeb et al. \cite{Saeb2015}, Canzian et al. \cite{Canzian2015}  and to some extend Cuttone et al. \cite{sparse-location-2014} forms the basis of this thesis with regard to mobility features. The work done by Palmius et al. \cite{palmius2017} is for the most part a continuation of the work by Saeb et al., but provides a highly insightful discussion of their findings.

% \paragraph{Saeb et al.} 
Saeb et al. provides a list of mobility features and relate them to mental state and user behaviour, the featueres are outlined in Table \ref{tab:saeb-features}. Out of these features the authors found that Home Stay, Location Variance, Normalized Entropy and Circadian movement correlate strongly with the PHQ9 score (see Appendix \ref{appendix:questionnaires}). Clinical assessment of depressive symptoms is usually done using questionnaires, such as the patient health questionnaire (PHQ-9). These questionnaires evaluate symptoms related to the patients state of mind, which for depressed patients tend to change. Saeb et al. finds a strong correlation between certain mobility features and the PHQ9 score obtained by the patients in a field study. Their findings therefore indicate that it is possible to monitor depression passively using GPS data tracked via the smart-phone. They explain that most people are unwilling to answer questions repeatedly over long periods of time, which is the case with an evaluation system based on the PHQ9 questionnaire. Passive monitoring via the patients smartphone could great improve the management of depression in populations by discovering relapses of high-risk patients earlier, so that they may receive the treatment they need before it is too late. \\

\input{chapters/02-related-work/tables/saeb-table}

% \paragraph{Canzian et al.} 
Canzian et al. provides a contribution similar to Saeb et al. and additionally discusses how existing digital systems for diagnosing depression require the user to interact with the device. These interactions can be inputs such as mood-state provided a few times a day, which is highly subjective and thus error-prone. Canzian et al. addresses this issue via objective patient data, namely the mobility patterns of users. These patterns were derived from location data gathering through smartphone apps, which as Canzian et al. puts it, is unobtrusive monitoring. These patterns are described by the mobility metrics (i.e. features) listed in Table \ref{tab:canzian-features}. The authors found a significant correlation between these metrics and depressive moods similar to \cite{Saeb2015} for which the \textit{PHQ-8} questionnaire is used as  reference. This is the same questionnaire as the PHQ9, although only containing the first 8 questions. While Canzian et al. and Saeb et al. describe many of the same features, Canzian provides much more detailed definitions of the features. A good example of this is the \textit{Routine Index} feature, which loosely corresponds to the \textit{Circadian Rhythm} feature in \cite{Saeb2015}. Canzian et al. \cite{Canzian2015} uses the notion of trajectories including \textit{places} and \textit{moves} defined by Spaccapietra et al. \cite{trajectories2008} to define the \textit{mobility trace} feature. This feature is used to derive the rest of the features, which is also the approach used for this thesis, although the terminology differs slightly.\\

\input{chapters/02-related-work/tables/canzian-table}


% \paragraph{Cuttone et al.} 
Cuttone et al. \cite{sparse-location-2014} investigates how accurate significant locations can be inferred from sparsely sampled location data using the GPS tracker in smartphones. For longitudinal studies it can be a problem for the phone battery if the sampling rate is too high. Therefore a more low-energy approach is used where the sampling rate- and the location accuracy are low. A small-scale study was conducted in which location data collected continuously and the users filled out an online diary on a daily basis. The aim was to compute features \textit{Stops} and \textit{Places of Interest (POI)} for each user and match them with the provided answers. These features are described in Table \ref{tab:features-cuttone}. \\

\input{chapters/02-related-work/tables/cuttone-table}

The work by Palmius et al. \cite{palmius2017} aims to identify periods of depression using location data collected from mobile phones in a study of individuals suffering from bipolar disorder. The authors conclude that location data features can provide a useful tool for identifying depressive symptoms in bipolar patients. Palmius et al. uses many of the same features as Saeb et. al \cite{Saeb2015, saeb2016} which are found in Table \ref{tab:palmius-features}.

\input{chapters/02-related-work/tables/palmius-table}

\subsection{Data Collection}
% Canzian
Canzian et al. built a custom Android app (MoodTraces) which collected data from 46 users over almost 10 months. The app had participants fill out a survey daily between 16:00 and 02:00 the subsequent day, where a phone notification prompted the participant to fill out the survey. Each survey contained a 'trap' question which asked whether the user was current at home or work. The answer to this question could be verified in the data analysis phase, and was used to filter out invalid surveys. The survey asked the user to name all the depressive symptoms they had on that day. PHQ8 score is normally done by asking every 14 days, and have the participant answer how many times they had a symptom over the last 14 days. By using the questionnaires, the PHQ8 scores could be computed by summing the amount of days with the symptoms, which in total add up to a score. It would happen that users forgot to fill out their questionnaire or gave an invalid survey response, in which case an interpolation method was used to cover gaps in the data.\\

% Saeb
Saeb et al. used a custom Android application, Purple Robot, which collected the users' GPS data with a sampling rate set to once every 5 minutes. Participants had the application manually installed on their existing phones or were given an Android phone with the app pre-installed on it which they were to use as their primary phone. Participants filled out a PHQ9 questionnaire just prior to starting the study, and once again once the study concluded after 14 days.\\

% Cuttone method
 
Cuttone et al. conducted a study with 7 participants including the author, with the author being tracked for four months and the other participants being tracked for two months. Data collection was done with a custom smartphone app developed using the Funf Open Sensing framework \footnote{\url{https://www.funf.org/}}, where participants were provided an Android phone to use as their main phone. Sampling was carried out with a very low sampling rate of once were 15 minutes which had the upside of not draining the phone battery much. Participants were also instructed to fill out a daily diary of the place they had been at, and their movements. This was done through an online spreadsheet and participants were reminded via email. The authors comment that using diaries as ground truth is difficult due to participation compliance decreasing over time, since filling out a diary is tedious. In addition the concepts of stops and POIs are somewhat ambiguous and subjective which means that even if participants do fill out their diary, it is subjective and error-prone. This was evident in the study where participants would sometimes fill out sequences of POIs in the wrong temporal order, and entries were prone to have typos in them which later had to be manually corrected by the researcher. At the end of the study the participants were asked to create a subjective list of their POIs with coordinates obtained through Google Maps. \\

% Palmius method
Palmius et al. collected data from 49 participants over 3 months in which a open-sourced Android application was used. Participants were provided an Android smart-phone with the app pre-installed in order to track their location for the duration of the study. Two groups of participants were recruited for the study:

\begin{itemize}
    \item Healthy patients with no symptoms (20)
    \item Patients diagnosed with bipolar disorder or borderline personality disorder (29)
\end{itemize}

Patients self-reported via a questionnaire with 16 questions on a weekly basis which, similar to the PHQ questionnaire, scores the patient on a depression scale. Participants were reminded to fill out the questionnaire via e-mail on a weekly basis. The questionnaire could be completed until the next reminder was sent out, and because of this, an interpolation method was used to streamline the response times. This interpolation also corrected for whenever participants would forget to fill out the questionnaire. 

\subsection{Data Processing}
% Saeb features
Saeb et al. uses a two-stage pipeline for location data processing: 
\begin{itemize}
    \item Each data point is labeled as either being in a stationary or transitional state by using the speed of each data point. Points are labeled using a threshold of 1 km/h; a speed lower than the threshold indicates the state is stationary and higher is a transitional point. 
    \item The K-means clustering algorithm is used to group the \textit{stationary points} into frequently visited places. Since the number of places, i.e. the number of clusters for the K-means algorithm (the parameter \textit{K}) is not known beforehand, the best parameter value is found using cross-validation.
\end{itemize}

After this pre-processing procedure was applied, the features described in Table \ref{tab:saeb-features} were derived.\\ 

%Canzian features
Canzian et al. uses an algorithm for sampling location data in a way which saves phone battery but also helps identify places. For this, the accelerometer is used by an activity recognition algorithm to determine the user's activity state. This is done by modelling the user as being a state-machine with 3 states: 
\begin{itemize}
    \item Static (S)
    \item Moving (M)
    \item Undecided (U)
\end{itemize}

A user is said to arrive at a place if the transition $M \rightarrow U \rightarrow S$ happens and a departure is noted when $S \rightarrow U \rightarrow M$ happens. By using all the location samples in between the arrival and departure, the centroid of the place can be found using a clustering algorithm. In addition, an iterative clustering algorithm is used to merge places with close proximity to each other, specifically a distance of 200 meters is used as the merging criterion. \\ 

% Cuttone Features

Cuttone et al. used two main approaches for finding stops and POIs. The first in voles finding stops first and then grouping stops into POIs. The second approach works the other way around and identifies POIs first by clustering the location data, and infers the stops from these POIs afterward. For finding the stops, 2 different algorithms, Distance Grouping and Speed Thresholding, were tried each yielding similar results.

\begin{itemize}
    \item Distance grouping involves iterating location points temporally and grouping them based on a max-distance measure. Each stop is created with a single location point $loc_{i}$ and each subsequent location point $loc_{i+k}$ is then added to the stop, with $k$ being incremented by 1 each iteration. This is done until $distance(loc_{i}, loc_{i+k} > d_{max}$ where $d_{max}$ is the maximum allowed distance. By increasing the max-distance fewer stops of longer duration will be found. For finding the optimal value of this parameter, the $f_1$ score was calculated for the specific dataset.  

    \item Speed thresholding determines which location points belonged to stops, and which points did not. The max-speed parameter was determined by grouping data samples based on their timestamp, each group having a duration of $T$. Choosing the max-speed parameter was then done by considering the speed between the median location of each bin. Gaussian Mixture Modelling was also tried which looks at all the location samples independent of their timestamp, and identifies POIs directly from clusters with large densities. 
\end{itemize}

For both these algorithms, the DBSCAN clustering algorithm by Ester et al. \cite{density-based-1996} was applied afterwards, which groups stops into places and marks noisy stops as not belonging to a place.\\

The second approach used a \textit{Gaussian Mixture Model} to cluster the raw location data into places, and infer the stops from these clusters. The upside to this method is that it is much simpler to perform on paper, but the downside is that it does not consider the temporal dimension at all which can contain a lot of useful information. This means the GMM uses more compute power than the other two approaches. \\

For this thesis, a modified version of the distance grouping algorithm was chosen is described in Chapter \ref{chapter:03}.

% Palmius Features
Palmius et al. notes how the location data collected through the Android platform varies in accuracy based whether the data comes from a satelite, wireless access access points or cell-phone towers. The authors therefore performed a de-noising of the location data by removing points sampled close to each-other, analogous to how Cuttone et al. finds stops. The dataset was further down-sampled to a sample rate of 12 samples per hour. Additionally, data imputation was applied to cover gaps in the location data by using the mean latitude and longitude of the sample before and after the gap. \\

For extracting location clusters, the down-sampled and imputed data was subjected to speed-thresholding using a speed of 1.5km/h as the threshold. Samples with a speed lower than this were considered stationary, and were clustered with the K-means++ algorithm, an improvement to the original K-means algorithm. The optimal number of clusters, $K$, was found by setting $K=1$ and increasing $K$ until a the centroids of all clusters were less than 400 meters apart. This parameter value was specific to their dataset.\\

The home location cluster was identified by computing the most visited cluster between 02 AM and 07 AM. The remaining features were computed in a similar fashion to Saeb et al. from which the authors have drawn a lot of inspiration. Additionally, the \textit{Diurnal Movement} feature is equivalent to the \textit{Circadian Movement }feature from Saeb et al. (see Table \ref{tab:saeb-features}). In addition to the features listed in Table \ref{tab:palmius-features}, Palmius et al. also creates a weekday and weekend subset of the features which are used in the feature selection process. It can expected for some individuals, namely full-time employees, to have very different feature values on weekdays where they work compared to the weekend.\\

A classification accuracy of 85\% was achieved by using 5 features found through cross-validation which were:

\begin{itemize}
    \item Entropy (WD)
    \item Number of Clusters
    \item Time Travelled (WD)
    \item Diurnal Movement on the Distance From Home
    \item Diurnal Movement
\end{itemize}

Here, WD refers to the feature computed on weekdays only.\\

\subsection{Feature Discussion}
Saeb et al. finds that the features that correlated the strongest with the PHQ9 score were 
\begin{itemize}
    \item Circadian Movement (negative)
    \item Location Variance (negative)
    \item Normalized Entropy (negative)
    \item Home Stay (positive)
\end{itemize}

The authors discuss how the negative correlation of the Circadian Movement feature suggests that depressed individuals tend to have a less regular routine compared to people with non-symptomatic people. This relationship also exists for the Location Variance and Normalized Entropy which indicates that spending time at many different places is correlated with being depressed. A positive relationship exist between the Home Stay feature and the PHQ9 score, indicating that depressed individuals tend to stay at home a lot of the time. This means there is a duality; it is a sign of being depressed to be spend time at many places, but also to spend most of the time only at a single place, i.e. home.\\

Palmius et al. also points this out and attributes their mis-classifications to how certain features may correlate differently with depressive symptoms, based on the patient. As an example they mention being employed at a full-time job, which keeps an individual tied to a routine, even if they are unwell. Another example provided is that some people choose to stay at home for reasons unrelated to their pathology. 